"use strict";
var _WrapperKeepOpaque_Type, _WrapperKeepOpaque_decoded, _WrapperKeepOpaque_opaqueName;
Object.defineProperty(exports, "__esModule", { value: true });
exports.WrapperKeepOpaque = void 0;
const tslib_1 = require("tslib");
const util_1 = require("@polkadot/util");
const Raw_js_1 = require("../native/Raw.js");
const index_js_1 = require("../utils/index.js");
const Bytes_js_1 = require("./Bytes.js");
function decodeRaw(registry, typeName, value) {
    const Type = (0, index_js_1.typeToConstructor)(registry, typeName);
    if ((0, util_1.isU8a)(value) || (0, util_1.isHex)(value)) {
        try {
            const [, u8a] = (0, util_1.isHex)(value)
                ? [0, (0, util_1.u8aToU8a)(value)]
                : (value instanceof Raw_js_1.Raw)
                    ? [0, value.subarray()]
                    : (0, util_1.compactStripLength)(value);
            return [Type, new Type(registry, u8a), value];
        }
        catch {
            return [Type, null, value];
        }
    }
    const instance = new Type(registry, value);
    return [Type, instance, (0, util_1.compactAddLength)(instance.toU8a())];
}
class WrapperKeepOpaque extends Bytes_js_1.Bytes {
    constructor(registry, typeName, value, { opaqueName = 'WrapperKeepOpaque' } = {}) {
        const [Type, decoded, u8a] = decodeRaw(registry, typeName, value);
        super(registry, u8a);
        _WrapperKeepOpaque_Type.set(this, void 0);
        _WrapperKeepOpaque_decoded.set(this, void 0);
        _WrapperKeepOpaque_opaqueName.set(this, void 0);
        tslib_1.__classPrivateFieldSet(this, _WrapperKeepOpaque_Type, Type, "f");
        tslib_1.__classPrivateFieldSet(this, _WrapperKeepOpaque_decoded, decoded, "f");
        tslib_1.__classPrivateFieldSet(this, _WrapperKeepOpaque_opaqueName, opaqueName, "f");
    }
    static with(Type) {
        return class extends WrapperKeepOpaque {
            constructor(registry, value) {
                super(registry, Type, value);
            }
        };
    }
    /**
     * @description Checks if the wrapper is decodable
     */
    get isDecoded() {
        return !!tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f");
    }
    /**
     * @description Returns a breakdown of the hex encoding for this Codec
     */
    inspect() {
        return tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f")
            ? {
                inner: [tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f").inspect()],
                outer: [(0, util_1.compactToU8a)(this.length)]
            }
            : {
                outer: [(0, util_1.compactToU8a)(this.length), this.toU8a(true)]
            };
    }
    /**
     * @description Converts the Object to to a human-friendly JSON, with additional fields, expansion and formatting of information
     */
    toHuman(isExtended) {
        return tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f")
            ? tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f").toHuman(isExtended)
            : super.toHuman();
    }
    /**
     * @description Converts the value in a best-fit primitive form
     */
    toPrimitive() {
        return tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f")
            ? tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f").toPrimitive()
            : super.toPrimitive();
    }
    /**
     * @description Returns the base runtime type name for this instance
     */
    toRawType() {
        return `${tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_opaqueName, "f")}<${this.registry.getClassName(tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_Type, "f")) || (tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f") ? tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f").toRawType() : new (tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_Type, "f"))(this.registry).toRawType())}>`;
    }
    /**
     * @description Converts the Object to to a string (either decoded or bytes)
     */
    toString() {
        return tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f")
            ? tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f").toString()
            : super.toString();
    }
    /**
     * @description Returns the decoded that the WrapperKeepOpaque represents (if available), throws if non-decodable
     */
    unwrap() {
        if (!tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f")) {
            throw new Error(`${tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_opaqueName, "f")}: unwrapping an undecodable value`);
        }
        return tslib_1.__classPrivateFieldGet(this, _WrapperKeepOpaque_decoded, "f");
    }
}
exports.WrapperKeepOpaque = WrapperKeepOpaque;
_WrapperKeepOpaque_Type = new WeakMap(), _WrapperKeepOpaque_decoded = new WeakMap(), _WrapperKeepOpaque_opaqueName = new WeakMap();
