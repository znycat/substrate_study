"use strict";
var _LRUCache_instances, _LRUCache_data, _LRUCache_refs, _LRUCache_length, _LRUCache_head, _LRUCache_tail, _LRUCache_toHead;
Object.defineProperty(exports, "__esModule", { value: true });
exports.LRUCache = void 0;
const tslib_1 = require("tslib");
const DEFAULT_CAPACITY = 128;
class LRUNode {
    constructor(key) {
        this.key = key;
        this.next = this.prev = this;
    }
}
class LRUCache {
    constructor(capacity = DEFAULT_CAPACITY) {
        _LRUCache_instances.add(this);
        _LRUCache_data.set(this, new Map());
        _LRUCache_refs.set(this, new Map());
        _LRUCache_length.set(this, 0);
        _LRUCache_head.set(this, void 0);
        _LRUCache_tail.set(this, void 0);
        this.capacity = capacity;
        tslib_1.__classPrivateFieldSet(this, _LRUCache_head, tslib_1.__classPrivateFieldSet(this, _LRUCache_tail, new LRUNode('<empty>'), "f"), "f");
    }
    get length() {
        return tslib_1.__classPrivateFieldGet(this, _LRUCache_length, "f");
    }
    get lengthData() {
        return tslib_1.__classPrivateFieldGet(this, _LRUCache_data, "f").size;
    }
    get lengthRefs() {
        return tslib_1.__classPrivateFieldGet(this, _LRUCache_refs, "f").size;
    }
    entries() {
        const keys = this.keys();
        const entries = new Array(keys.length);
        for (let i = 0; i < keys.length; i++) {
            const key = keys[i];
            entries[i] = [key, tslib_1.__classPrivateFieldGet(this, _LRUCache_data, "f").get(key)];
        }
        return entries;
    }
    keys() {
        const keys = [];
        if (tslib_1.__classPrivateFieldGet(this, _LRUCache_length, "f")) {
            let curr = tslib_1.__classPrivateFieldGet(this, _LRUCache_head, "f");
            while (curr !== tslib_1.__classPrivateFieldGet(this, _LRUCache_tail, "f")) {
                keys.push(curr.key);
                curr = curr.next;
            }
            keys.push(curr.key);
        }
        return keys;
    }
    get(key) {
        const data = tslib_1.__classPrivateFieldGet(this, _LRUCache_data, "f").get(key);
        if (data) {
            tslib_1.__classPrivateFieldGet(this, _LRUCache_instances, "m", _LRUCache_toHead).call(this, key);
            return data;
        }
        return null;
    }
    set(key, value) {
        if (tslib_1.__classPrivateFieldGet(this, _LRUCache_data, "f").has(key)) {
            tslib_1.__classPrivateFieldGet(this, _LRUCache_instances, "m", _LRUCache_toHead).call(this, key);
        }
        else {
            const node = new LRUNode(key);
            tslib_1.__classPrivateFieldGet(this, _LRUCache_refs, "f").set(node.key, node);
            if (this.length === 0) {
                tslib_1.__classPrivateFieldSet(this, _LRUCache_head, tslib_1.__classPrivateFieldSet(this, _LRUCache_tail, node, "f"), "f");
            }
            else {
                tslib_1.__classPrivateFieldGet(this, _LRUCache_head, "f").prev = node;
                node.next = tslib_1.__classPrivateFieldGet(this, _LRUCache_head, "f");
                tslib_1.__classPrivateFieldSet(this, _LRUCache_head, node, "f");
            }
            if (tslib_1.__classPrivateFieldGet(this, _LRUCache_length, "f") === this.capacity) {
                tslib_1.__classPrivateFieldGet(this, _LRUCache_data, "f").delete(tslib_1.__classPrivateFieldGet(this, _LRUCache_tail, "f").key);
                tslib_1.__classPrivateFieldGet(this, _LRUCache_refs, "f").delete(tslib_1.__classPrivateFieldGet(this, _LRUCache_tail, "f").key);
                tslib_1.__classPrivateFieldSet(this, _LRUCache_tail, tslib_1.__classPrivateFieldGet(this, _LRUCache_tail, "f").prev, "f");
                tslib_1.__classPrivateFieldGet(this, _LRUCache_tail, "f").next = tslib_1.__classPrivateFieldGet(this, _LRUCache_head, "f");
            }
            else {
                tslib_1.__classPrivateFieldSet(this, _LRUCache_length, tslib_1.__classPrivateFieldGet(this, _LRUCache_length, "f") + 1, "f");
            }
        }
        tslib_1.__classPrivateFieldGet(this, _LRUCache_data, "f").set(key, value);
    }
}
exports.LRUCache = LRUCache;
_LRUCache_data = new WeakMap(), _LRUCache_refs = new WeakMap(), _LRUCache_length = new WeakMap(), _LRUCache_head = new WeakMap(), _LRUCache_tail = new WeakMap(), _LRUCache_instances = new WeakSet(), _LRUCache_toHead = function _LRUCache_toHead(key) {
    const ref = tslib_1.__classPrivateFieldGet(this, _LRUCache_refs, "f").get(key);
    if (ref && ref !== tslib_1.__classPrivateFieldGet(this, _LRUCache_head, "f")) {
        ref.prev.next = ref.next;
        ref.next.prev = ref.prev;
        ref.next = tslib_1.__classPrivateFieldGet(this, _LRUCache_head, "f");
        tslib_1.__classPrivateFieldGet(this, _LRUCache_head, "f").prev = ref;
        tslib_1.__classPrivateFieldSet(this, _LRUCache_head, ref, "f");
    }
};
